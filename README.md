# docker-strongswan
strongSwan in a Docker container

A strongSwan server in a docker container with support for EAP-MSCHAPv2 and letsencrypt certificates.

<h1>Currently supported:</h1>

<h3>IKEv2:</h3>

EAP-MSCHAPv2 (Default Windows 10, IOS, MACOS X Client)

<h1>Minimal Docker Run command:</h1>

```
docker run --rm -d --privileged -e TZ=YOUR_TZ -e SERVER_DOMAIN=YOUR_DOMAIN -p 500:500/udp -p 4500:4500/udp -v YOUR_FOLDER:/root -v /lib/modules:/lib/modules --name=strongSwan themardy/strongswan:latest
```

<h1>Retrieving the Root Certificate</h1>

To connect to the VPN, you need to install the Root Certificate generated by the container. To retrieve it, copy it from the log:

```
docker logs strongswan
```

and paste it in a file with a .pem extention. E.g. vpn.pem

Next, install the certificate using the following instructions:

<h3>IOS</h3> 

Send the certificate to your device and open it. Follow the instructions to install it.

<h3>Windows</h3> 
  
Press Start+R, type certmgr.msc and press enter. This opens up the Certificates Manager. Next, left-click "Trusted Root Certificates" (second folder) and right-click certificates -> all actions -> import. Follow the instructions and import the .pem certificate. (You might need to change the filetype to all files if the certificate does not show up)

<h1>Creating users</h1>

```
docker exec -t strongswan /usr/bin/vpn_adduser USERNAME PASSWORD
```

Note: You need to restart the container after editing the ipsec.secrets / adding a user

```
docker restart strongswan
```

<h1>Variables</h1>

Required Variables:

| Variable  | Example |
| ------------- | ------------- |
| TZ  |  Europe/Amsterdam  |
| SERVER_DOMAIN  |  myddns.com |


Optional Variables:

| Variable  | Example |
| ------------- | ------------- |
| LEFTSUBNET  |  0.0.0.0/0,::/0  |
| DNS_SERVERS  |  1.0.0.1,2606:4700:4700::1111 |
| RIGHTSOURCEIP  |  10.10.10.0/24,fd9d:bc11:4020::/48 |

Volumes:

| Volume  | Explaination |
| ------------- | ------------- |
| /lib/modules:/lib/modules  |  strongSwan needs the /lib/modules to run  |
| YOUR_FOLDER:/root  |  Saves the Certificate files |

Ports: 

| Port  | Explaination |
| ------------- | ------------- |
| 500:500/udp  |  Needed by strongSwan  |
| 4500:4500/udp  |  Needed by strongSwan |


<h1>Tested on:</h1>

:white_check_mark: Windows 10 (Default IKEv2)

:white_check_mark: IOS 12

:white_check_mark: MacOS X

<h1>Let's Encrypt</h1>

Using Let's Encrypt certificates makes it easier to connect to your VPN server, yet less secure.

Step by step configuration:

Prerequisites: Your Let's Encrypt certificates.

1) Run the docker container using the run command stated above.

2) When the container is started, stop the container.

3) Copy your Let's Encrypt certificates into the YOUR_FOLDER/ca folders as follows:

```
cp .../fullchain.pem YOUR_FOLDER/ca/certs/fullchain.pem

cp .../chain.pem YOUR_FOLDER/ca/cacerts/chain.pem

cp .../privkey.pem YOUR_FOLDER/ca/private/privkey.pem
```
4) Restart the container using the run command stated above.
